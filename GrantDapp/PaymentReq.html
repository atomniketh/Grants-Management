<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Submit Invoice for Payment</title>

    <link rel="icon" type="image/png" href="images/faviconCSE.png" sizes="32x32"> 

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
   
    <!-- <script src="./src/scripts/require.js"></script> -->
    <!-- <script data-main="src/dappPayment.js" src="src/require.js"></script> -->

<script>updateList = function() {
  var input = document.getElementById('file');
  var output = document.getElementById('fileList');

  output.innerHTML = '<ul>';
  for (var i = 0; i < input.files.length; ++i) {
    output.innerHTML += '<li>' + input.files.item(i).name + '</li>';
  }
  output.innerHTML += '</ul>';
}</script>

<!-- loading the minified version using jsDelivr -->
<script src="https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js"></script>

</head>


<!-- 

X Get active wallet address

X Look up grants for that address

Don't show form if there is no matching Address in existing awards

X Populate dropdown of grants if multiple available

X Get available balance per contract state

Get available allowance per contract state

Also compare to getBalance to see if they subbed anything out

Check allowance

Drag and drop multiple files

Make sure Invoiced Amount <= Available Balance


 -->
<body>

  <h1>IPFS in the Browser</h1>
  <p>This page creates an IPFS node in your browser and drops it into the global Javascript namespace as <b><em style="background-color:#d7d6d6">node</em></b>. Open the console to play around with it.</p>
  <p>Note that opening two tabs of this page in the same browser won't work well, because they will share node configuration. You'll end up trying to run two instances of the same node, with the same private key and identity, which is a Bad Idea.</p>
  <h1 id="status">Node status: offline</h1>

  <h2>Some suggestions</h2>

  <p>Try adding a new file:</p>

  <code style="display:block; white-space:pre-wrap; background-color:#d7d6d6">
    node.files.add(new node.types.Buffer('Hello world!'), (err, filesAdded) => {
      if (err) {
        return console.error('Error - ipfs add', err, res)
      }

      filesAdded.forEach((file) => console.log('successfully stored', file.hash))
    })
  </code>

  <p>You can cat that same file. If you used the exact same string as above ('Hello world!') you should have an hash like this: 'QmQzCQn4puG4qu8PVysxZmscmQ5vT1ZXpqo7f58Uh9QfyY'</p>

  <code style="display:block; white-space:pre-wrap; background-color:#d7d6d6">
    node.files.cat('QmQzCQn4puG4qu8PVysxZmscmQ5vT1ZXpqo7f58Uh9QfyY', function (err, data) {
      if (err) {
        return console.error('Error - ipfs files cat', err, res)
      }

      console.log(data.toString())
    })
  </code>

  
<!-- <form class="generated-form"  method="POST" action="" enctype="multipart/form-data" target="_self"> -->
    <form onsubmit="myFunction(); return false;" enctype="multipart/form-data">
      <!-- <form method="post" action="PaymentProc.html" enctype="multipart/form-data"> -->
    <fieldset>
      <legend> Payment Request:: </legend>

      <label for="text">Award ID:</label> <input type="text" id="awardID" name="awardID"><br>
      <br>

        <label for="text">Vendor:</label> <input type="text" id="vendor" name="vendor"><br>
      <br>
        <label for="text">Grant Number:</label> <input type="text" id="grant" name="grant"><br>
        <br>

        <label for="text">Public Key:</label> <input type="text" id="pKey" name="pKey" size="45"><br>
        <br>

        <label for="text">Awarded Value:</label> <input type="text" id="awardValue" name="awardValue"><br>
        <br>

        <label for="text">Available Balance:</label> <input type="text" id="availBalance" name="availBalance"><br>
        <br>

        <label for="text">Labor CLIN:</label> <input type="text" id="laborClin" name="laborClin"><br>
        <br>

        <label for="text">Travel CLIN:</label> <input type="text" id="travelClin" name="travelClin"><br>
        <br>

        <label for="text">ODC CLIN:</label> <input type="text" id="odcClin" name="odcClin"><br>
        <br>

        <label for="text">Total Invoice:</label> <input type="text" id="totalInvoice" name="totalInvoice"><br>
        <br>

        <label for="file">File:</label><br>
        <!-- <input type="file" id="fileAttachment" name="fileAttachment" multiple accept=".doc, .docx, .pdf, .xls, .xlsx, .ppt, .pptx"><br><br> -->

        <input type="file" name="file" id="file" multiple accept=".doc, .docx, .pdf, .xls, .xlsx, .ppt, .pptx" onchange="javascript:updateList()" />
        <br/>Selected files:
        <div id="fileList"></div>

        <br>

        <label for="text">Comments:</label><br>
        <textarea id="addlComments" name="addlComments" rows="3" cols="50"> 
        </textarea><br><br>

        <label for="text">File contents:</label><br>
        <div id="fileContents" name="fileContents"> 
        </div><br><br>
        
        <button class="full" id="submitInvoice">Submit for Payment</button>
        <br>
        
    </fieldset>
    </form>
    
</body>
<script src="src/dappWeb3.js"></script>
<script type="module" src="src/dappPayment.js"></script>


<!-- <script src="https://unpkg.com/ipfs-api/dist/index.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script> -->


<!-- This script prevents my forms from reloading the page onClick. -->
<script language="javascript"><!--
  function myFunction() {
      // Do stuff
  }
//--></script>
</html>